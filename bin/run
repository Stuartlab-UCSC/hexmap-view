#!/bin/bash
# Start a hexmap process passing one of: http, https, db, www

#INSTALL=prod
#INSTALL=dev
#INSTALL=devCalc
#INSTALL=swat
#INSTALL=swatCalc
#INSTALL=swatMain

if [ $INSTALL == 'prod' ]
    then HEXMAP=/data
fi
if [ $INSTALL == 'dev' ]
    then HEXMAP=/cluster/home/swat/hexmap
fi
if [ $INSTALL == 'devCalc' ]
    then HEXMAP=/cluster/home/swat/hexmapCalc
fi
if [ $INSTALL == 'swat' ]
    then HEXMAP=/Users/swat/dev/hexagram
fi
if [ $INSTALL == 'swatCalc' ]
    then HEXMAP=/Users/swat/devCalc
fi
if [ $INSTALL == 'swatMain' ]
    then HEXMAP=/Users/swat/devMain
fi

source $HEXMAP/runInclude

if [ $1 == 'http' ]
    then
    touch $HEXMAP/http.log
    mv $HEXMAP/http.log $HEXMAP/http.prev.log
    (nohup $METEOR_BASE/bin/node $HEXMAP/http/http.js &> $HEXMAP/http.log &)
    echo Starting $1
fi
if [ $1 == 'https' ]
    then
    touch $HEXMAP/https.log
    mv $HEXMAP/https.log $HEXMAP/https.prev.log
    (nohup $METEOR_BASE/bin/node $HEXMAP/https/https.js &> $HEXMAP/https.log &)
    echo Starting $1
fi
if [ $1 == 'db' ]
    then
    touch $HEXMAP/db.log
    mv $HEXMAP/db.log $HEXMAP/db.prev.log &&
    (nohup $METEOR_BASE/mongodb/bin/mongod \
            --bind_ip 127.0.0.1 \
            --port $DB_PORT \
            --dbpath $HEXMAP/db \
            &> $HEXMAP/db.log &)
    echo Starting $1
fi
if [ $1 == 'dbInsecure' ]
    then
    touch $HEXMAP/db.log
    mv $HEXMAP/db.log $HEXMAP/db.prev.log &&
    (nohup $METEOR_BASE/mongodb/bin/mongod \
            --port $DB_PORT \
            --dbpath $HEXMAP/db \
            &> $HEXMAP/db.log &)
    echo Starting $1
fi
if [ $1 == 'www' ]
    then
    export MONGO_URL=mongodb://localhost:$DB_PORT/$DB_NAME
    cd $HEXMAP/www
    touch $HEXMAP/www.log
    mv $HEXMAP/www.log $HEXMAP/www.prev.log
    echo SETTINGS: $SETTINGS
    (nohup $METEOR/meteor --port $PORT --settings $SETTINGS &> $HEXMAP/www.log &)
    echo Starting $1
fi
if [ $1 == 'wwwLocal' ]
    then
    export MONGO_URL=mongodb://localhost:$DB_PORT/$DB_NAME
    cd $HEXMAP/www
    touch $HEXMAP/www.log
    mv $HEXMAP/www.log $HEXMAP/www.prev.log
    echo Starting $1
    $METEOR/meteor --port $PORT --settings $SETTINGS
fi
