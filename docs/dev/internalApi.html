<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Internal computation API &#8212; Tumor Map Developer Documentation</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API: N-of-1 Analysis" href="overlayNodes.html" />
    <link rel="prev" title="Developer Docs" href="index.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">Tumor Map Developer Documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="index.html" title="Developer Docs"
             accesskey="P">previous</a> |
          <a href="overlayNodes.html" title="API: N-of-1 Analysis"
             accesskey="N">next</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="internal-computation-api">
<h1>Internal computation API<a class="headerlink" href="#internal-computation-api" title="Permalink to this headline">¶</a></h1>
<p>The &#8216;hub&#8217; contains an http server, data files and scripts that perform
computations on those data files. The http server responds to requests for data
files and requests for computations using the web APIs described at:
<a class="reference external" href="https://tumormap.ucsc.edu/query/index.html">https://tumormap.ucsc.edu/query/index.html</a></p>
<p>This page describes the internal API for calling computation scripts upon
receipt of a request via the web API.</p>
<div class="section" id="prior-to-script-call">
<h2>Prior to script call<a class="headerlink" href="#prior-to-script-call" title="Permalink to this headline">¶</a></h2>
<p>Prior to calling the script, parameters received in the http request are
extracted from JSON into a python data structure and validated.</p>
<p>File paths are derived from the map ID, etc before calling the script.</p>
</div>
<div class="section" id="script-call">
<h2>Script call<a class="headerlink" href="#script-call" title="Permalink to this headline">¶</a></h2>
<p>The computation script is called from the http server via a spawned python
process, passing the parameters as a python data structure to a function named
&#8216;webApi&#8217;.</p>
<p>Defaults for parameters not provided should be set by the computation script in
webApi&#8217;s parameters. Any other defaults should be set in common code used via
the web API, command-line, or other entry points so that they are set in only
one place.</p>
</div>
<div class="section" id="successful-return">
<h2>Successful return<a class="headerlink" href="#successful-return" title="Permalink to this headline">¶</a></h2>
<p>The script should return a python data struct upon success. Any output written
to stdout or stderr is ignored.</p>
</div>
<div class="section" id="failure-return">
<h2>Failure return<a class="headerlink" href="#failure-return" title="Permalink to this headline">¶</a></h2>
<p>The script should return a one upon failure. Explicitly-caught errors should be
reported via stderr before returning with a one.</p>
<p>The script should capture any errors not explicitly captured with this sort of
logic:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">return_value</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="n">return_value</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">return_value</span><span class="p">)</span>
</pre></div>
</div>
<p>Any output to stdout is ignored.</p>
<p>Note that this is more standard and different from our previous way of calling
scripts where an explicitly-caught error wrote a message beginning with &#8216;Error&#8217;
to stdout and returned a value of zero.</p>
</div>
<div class="section" id="after-script-call">
<h2>After script call<a class="headerlink" href="#after-script-call" title="Permalink to this headline">¶</a></h2>
<p>Any email addresses included in the request are used to send a job completion
message. Any URLs needed are generated and returned to the original web API
caller.</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Internal computation API</a></li>
<li class="toctree-l1"><a class="reference internal" href="overlayNodes.html">API: N-of-1 Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="createMap.html">API: Create a map</a></li>
<li class="toctree-l1"><a class="reference internal" href="source.html">Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="clientSource.html">Source: Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="serverSource.html">Source: Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="repository.html">Code Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements &amp; Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">This Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="licenses.html">Licenses</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="index.html" title="Developer Docs"
              >previous</a> |
            <a href="overlayNodes.html" title="API: N-of-1 Analysis"
              >next</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/internalApi.rst.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, UCSC Tumor Map development team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>